<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="aidboat">
	<xacro:macro name="collisions" params="prefix reflect">
		<collision name="${prefix}_hull">
			<origin xyz="0.273998 ${reflect*(0.447)} -0.146" rpy="0 0 ${reflect*(-0.0244346)}"/>
			<geometry>
				<box size="2.002 0.286 0.292"/>
			</geometry>
		</collision>
	</xacro:macro>

	<link name="base_link">
	</link>

	<joint name="dummy_joint" type="fixed">
		<parent link="base_link"/>
		<child link="dummy_link" />
	</joint>

	<link name="dummy_link">
		<inertial>
			<mass value="32.712"/>
			<origin xyz="0 0.26377 0.02064" rpy="0 0 0"/>		
			<inertia ixx="4.662514672" ixy="0" ixz="0" iyy="12.57628507" iyz="0" izz="15.22053986"/>
		</inertial>

		<collision name="top_base">
			<origin xyz="0 0 0.1255" rpy="0 0 0"/>
			<geometry>
				<box size="0.73 1.15767 0.251"/>
			</geometry>
		</collision>

		<xacro:collisions prefix="right" reflect="1"/>
		<xacro:collisions prefix="left" reflect="-1"/>

		<visual>
			<origin rpy="0 0 0" xyz="0 0 0.292"/>
			<geometry>
				<mesh filename="package://aidboat_description/models/aidboat_base/mesh/AIDBOAT_Base.dae"/>
			</geometry>
		</visual>
	</link>
    <link name="left_engine_link">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 -0.0244346" />
            <geometry>
                <mesh filename="package://aidboat_description/models/engine/mesh/left_engine.dae"/>
            </geometry>
        </visual>
        <collision>
            <origin xyz="0.011 0 0" rpy="0 1.5708 -0.0244346" />
            <geometry>
                <cylinder length="0.113" radius="0.05" />
            </geometry>
        </collision>
        <inertial>
            <mass value="0.126"/>
            <inertia ixx="0.00002900992" ixy="0" ixz="0" iyy="0.00002900992" iyz="0" izz="0.0001575"/>
        </inertial>
    </link>

    <link name="left_propeller_link">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 -0.0244346" />
            <geometry>
                <mesh filename="package://aidboat_description/models/propeller/mesh/left_propeller.dae" />
            </geometry>
        </visual>
        <collision>
            <origin xyz="0.011 0 0" rpy="0 1.5708 -0.0244346" />
            <geometry>
                <cylinder length="0.03" radius="0.0381" />
            </geometry>
        </collision>
        <inertial>
            <mass value="0.030"/>
            <inertia ixx="0.00000058378" ixy="0" ixz="0" iyy="0.00000058378" iyz="0" izz="0.00002177415" />
        </inertial>
    </link>

    <joint name="left_chasis_engine_joint" type="fixed">
        <origin xyz="-0.741 0.47 -0.016" rpy="0 0 0"/>
        <parent link="base_link"/>
        <child link="left_engine_link"/>
    </joint>

    <joint name="left_engine_propeller_joint" type="continuous">
        <axis rpy="0 0 0" xyz="1 0 0" />
        <parent link="left_engine_link"/>
        <child link="left_propeller_link"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <limit effort="0.7250" velocity="369.97489" />
        <dynamics friction="0.05" damping="0.05" />
    </joint>

    <link name="right_engine_link">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0.0244346" />
            <geometry>
                <mesh filename="package://aidboat_description/models/engine/mesh/right_engine.dae"/>
            </geometry>
        </visual>
        <collision>
            <origin xyz="0.011 0 0" rpy="0 1.5708 0.0244346" />
            <geometry>
                <cylinder length="0.113" radius="0.05" />
            </geometry>
        </collision>
        <inertial>
            <mass value="0.126"/>
            <inertia ixx="0.00002900992" ixy="0" ixz="0" iyy="0.00002900992" iyz="0" izz="0.0001575"/>
        </inertial>
    </link>

    <link name="right_propeller_link">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0.0244346" />
            <geometry>
                <mesh filename="package://aidboat_description/models/propeller/mesh/right_propeller.dae" />
            </geometry>
        </visual>
        <collision>
            <origin xyz="0.011 0 0" rpy="0 1.5708 0.0244346" />
            <geometry>
                <cylinder length="0.03" radius="0.0381" />
            </geometry>
        </collision>
        <inertial>
            <mass value="0.030"/>
            <inertia ixx="0.00000058378" ixy="0" ixz="0" iyy="0.00000058378" iyz="0" izz="0.00002177415" />
        </inertial>
    </link>

    <joint name="right_chasis_engine_joint" type="fixed">
        <origin xyz="-0.741 -0.47 -0.016" rpy="0 0 0"/>
        <parent link="base_link"/>
        <child link="right_engine_link"/>
    </joint>

    <joint name="right_engine_propeller_joint" type="continuous">
        <axis rpy="0 0 0" xyz="1 0 0" />
        <parent link="right_engine_link"/>
        <child link="right_propeller_link"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <limit effort="0.7250" velocity="369.97489" />
        <dynamics friction="0.05" damping="0.05" />
    </joint>

    <gazebo>
        <plugin name="usv_dynamics_aidboat" filename="libusv_gazebo_dynamics_plugin.so">
            <bodyName>base_link</bodyName>
                <!-- Must be same as the oxean model! -->
            <waterLevel>0</waterLevel>
            <waterDensity>997.8</waterDensity>
                <!-- Added mass -->
            <xDotU>0.0</xDotU>
            <yDotV>0.0</yDotV>
            <nDotR>0.0</nDotR>
                <!-- Linear and quadratic drag -->
            <xU>51.3</xU>
            <xUU>72.4</xUU>
            <yV>40.0</yV>
            <yVV>0.0</yVV>
            <zW>500.0</zW>
            <kP>50.0</kP>
            <mQ>50.0</mQ>
            <nR>400.0</nR>
            <nRR>0.0</nRR>
                <!-- General dimensions -->
                <!-- <boatArea>2.2</boatArea> -->
            <hullRadius>0.213</hullRadius>
            <boatWidth>1.15767</boatWidth>
            <boatLength>2.05992</boatLength>
                <!-- Length discretazion, AKA, "N" -->
            <length_n>2</length_n>
               <!-- Wave model -->
            <wave_model>ocean_waves</wave_model>
        </plugin>
    </gazebo>  
    <gazebo>
        <plugin name="aidboat_gazebo_thrust" filename="libusv_gazebo_thrust_plugin.so" xmlns:xacro="http://ros.org/wiki/xacro">
            <cmdTimeout>1.0</cmdTimeout>
            <thruster>
                <linkName>left_propeller_link</linkName>
                <propJointName>left_engine_propeller_joint</propJointName>
                <engineJointName>left_chasis_engine_joint</engineJointName>
                <cmdTopic>left_thrust_cmd</cmdTopic>
                <angleTopic>left_thrust_angle</angleTopic>
                <enableAngle>false</enableAngle>
            </thruster>
            <thruster>
                <linkName>right_propeller_link</linkName>
                <propJointName>right_engine_propeller_joint</propJointName>
                <engineJointName>right_chasis_engine_joint</engineJointName>
                <cmdTopic>right_thrust_cmd</cmdTopic>
                <angleTopic>right_thrust_angle</angleTopic>
                <enableAngle>false</enableAngle>
            </thruster>
        </plugin>
    </gazebo> 
</robot>